function  [v11, v12] = S_LS_User1(H11, H12, H21, H22, g1, g2, v21, v22, M, n0, x1_b, x2_b, w1, w2)
%update filters by sudo-LS algorithm 

lambda1 = 0.5;

%received signal vectors
y1 = H11'*g1*x1_b+H21'*g2*x2_b;
y2 = H12'*g1*x1_b+H22'*g2*x2_b;

%estimations
Ex1y1 = mean([x1_b;x1_b].*y1,2);
Ex2y1 = mean([x2_b;x2_b].*y1,2);
Ex1y2 = mean([x1_b;x1_b].*y2,2);
Ex2y2 = mean([x2_b;x2_b].*y2,2);

%filters
v11 = ( 2*Ex1y1*Ex1y1'*w1 + 2*Ex2y1*Ex2y1'*w2 + 2*lambda1'*eye(2))\...
      ( 2*Ex1y1*w1 - Ex1y2'*v21*Ex1y1*w1...
        -Ex1y1*v21'*Ex1y2*w1...
        -Ex2y2'*v21*Ex2y1*w2...
        -Ex2y1*v21'*Ex2y2*w2);
    
v12 = ( 2*Ex1y1*Ex1y1'*w1 + 2*Ex2y1*Ex2y1'*w2 + 2*lambda1'*eye(2))\...
      ( 2*Ex2y1*w2 - Ex1y2'*v22*Ex1y1*w1...
        -Ex1y1*v22'*Ex1y2*w1...
        -Ex2y2'*v22*Ex2y1*w2...
        -Ex2y1*v22'*Ex2y2*w2);
    
norm(v11)^2+norm(v12)^2-1


%binary search for lambda1    
while abs(  norm(v11)^2+norm(v12)^2-1   ) > 10^(-6)
    
    if norm(v11)^2+norm(v12)^2  > 1
        
        lambda1 = (1+lambda1)/2
        
        v11 = ( 2*Ex1y1*Ex1y1'*w1 + 2*Ex2y1*Ex2y1'*w2 + 2*lambda1'*eye(2))\...
        ( 2*Ex1y1*w1 - Ex1y2'*v21*Ex1y1*w1...
        -Ex1y1*v21'*Ex1y2*w1...
        -Ex2y2'*v21*Ex2y1*w2...
        -Ex2y1*v21'*Ex2y2*w2);
    
        v12 = ( 2*Ex1y1*Ex1y1'*w1 + 2*Ex2y1*Ex2y1'*w2 + 2*lambda1'*eye(2))\...
        ( 2*Ex2y1*w2 - Ex1y2'*v22*Ex1y1*w1...
        -Ex1y1*v22'*Ex1y2*w1...
        -Ex2y2'*v22*Ex2y1*w2...
        -Ex2y1*v22'*Ex2y2*w2);
        
        norm(v11)^2+norm(v12)^2-1
    else
        
        lambda1 = lambda1/2
        
        v11 = ( 2*Ex1y1*Ex1y1'*w1 + 2*Ex2y1*Ex2y1'*w2 + 2*lambda1'*eye(2))\...
        ( 2*Ex1y1*w1 - Ex1y2'*v21*Ex1y1*w1...
        -Ex1y1*v21'*Ex1y2*w1...
        -Ex2y2'*v21*Ex2y1*w2...
        -Ex2y1*v21'*Ex2y2*w2);
    
        v12 = ( 2*Ex1y1*Ex1y1'*w1 + 2*Ex2y1*Ex2y1'*w2 + 2*lambda1'*eye(2))\...
        ( 2*Ex2y1*w2 - Ex1y2'*v22*Ex1y1*w1...
        -Ex1y1*v22'*Ex1y2*w1...
        -Ex2y2'*v22*Ex2y1*w2...
        -Ex2y1*v22'*Ex2y2*w2);
    
        norm(v11)^2+norm(v12)^2-1
        
    end
    
end

    
    